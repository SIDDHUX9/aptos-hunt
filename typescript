const OFFICIAL_TESTNET_URL = "https://api.testnet.aptoslabs.com/v1";

// Allow overriding via env vars, fallback to Official Testnet for reliability
const NODE_URL = import.meta.env.VITE_APTOS_NODE_URL || OFFICIAL_TESTNET_URL;
const API_KEY = import.meta.env.VITE_APTOS_API_KEY;

export const MODULE_ADDRESS = "0x155e43ac5e3c045997eae5fc8ccbcf9ddcc8dbd77849e4e54a40aa7d9dfd9ba9";
export const MODULE_NAME = "market";

// Force Testnet configuration
// Only use API_KEY if it is set and not a placeholder like "demo_key"
const validApiKey = API_KEY && API_KEY !== "demo_key" && !API_KEY.includes("placeholder") ? API_KEY : undefined;

console.log("Aptos Client Initialized with Node URL:", NODE_URL);

const config = new AptosConfig({
  network: Network.TESTNET,
  fullnode: NODE_URL,
  clientConfig: validApiKey ? { API_KEY: validApiKey } : undefined,
});

export const aptos = new Aptos(config);

const response = await signAndSubmitTransaction(transaction);
  
await markClaimed({ 
  claimId: claim._id as Id<"claims">, 
  transactionHash: response.hash 
});